{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.40.2.10011",
      "templateHash": "12409878407586625899"
    }
  },
  "functions": [
    {
      "namespace": "__bicep",
      "members": {
        "getSqlPassword": {
          "parameters": [],
          "output": {
            "type": "string",
            "value": "[variables('envParams').sqlAdministratorLoginPassword]"
          }
        }
      }
    }
  ],
  "parameters": {
    "environment": {
      "type": "string",
      "metadata": {
        "description": "Environment name (dev, uat, prod)"
      }
    }
  },
  "variables": {
    "$fxv#0": {
      "location": "australiaeast",
      "subscriptionName": "rebcsubtest",
      "vnetName": "vnet-rebc",
      "subnetName": "snet-rebc",
      "namePatterns": {
        "resourceGroup": "rg-rebc",
        "managedIdentity": "mi-rebc",
        "containerRegistry": "acraetestrebc",
        "containerAppsEnvironment": "cae-rebc",
        "containerAppJobBill": "caj-bill",
        "containerAppJobData": "caj-data",
        "sqlServer": "sql-rebc",
        "sqlDatabase": "db-rebc",
        "logAnalyticsWorkspace": "log-rebc",
        "privateEndpointContainerRegistry": "pe-cr",
        "privateEndpointContainerAppsEnvironment": "pe-cae",
        "privateEndpointSqlServer": "pe-sql"
      }
    },
    "$fxv#1": {
      "Project": "REBC",
      "ManagedBy": "Infrastructure Team",
      "CostCenter": "IT-001",
      "Department": "Infrastructure"
    },
    "$fxv#2": {
      "dev": {
        "deployResourceGroup": true,
        "deployManagedIdentity": true,
        "deployLogAnalyticsWorkspace": true,
        "deployContainerRegistry": true,
        "deployContainerAppsEnvironment": true,
        "deployContainerAppJobBill": true,
        "deployContainerAppJobData": true,
        "deploySqlServer": true,
        "deploySqlDatabase": true,
        "deployPrivateEndpointContainerRegistry": true,
        "deployPrivateEndpointContainerAppsEnvironment": true,
        "deployPrivateEndpointSqlServer": true,
        "sqlAdministratorLogin": "sqladmin",
        "sqlAdministratorLoginPassword": "P@ssw0rd123!Dev",
        "existingVnetResourceGroup": "rg-network-dev",
        "containerImage": "mcr.microsoft.com/azuredocs/containerapps-helloworld:latest"
      },
      "uat": {
        "deployResourceGroup": true,
        "deployManagedIdentity": true,
        "deployLogAnalyticsWorkspace": true,
        "deployContainerRegistry": true,
        "deployContainerAppsEnvironment": true,
        "deployContainerAppJobBill": true,
        "deployContainerAppJobData": true,
        "deploySqlServer": true,
        "deploySqlDatabase": true,
        "deployPrivateEndpointContainerRegistry": true,
        "deployPrivateEndpointContainerAppsEnvironment": true,
        "deployPrivateEndpointSqlServer": true,
        "sqlAdministratorLogin": "sqladmin",
        "sqlAdministratorLoginPassword": "P@ssw0rd123!Uat",
        "existingVnetResourceGroup": "rg-network-uat",
        "containerImage": "mcr.microsoft.com/azuredocs/containerapps-helloworld:latest"
      },
      "prod": {
        "deployResourceGroup": true,
        "deployManagedIdentity": true,
        "deployLogAnalyticsWorkspace": true,
        "deployContainerRegistry": true,
        "deployContainerAppsEnvironment": true,
        "deployContainerAppJobBill": true,
        "deployContainerAppJobData": true,
        "deploySqlServer": true,
        "deploySqlDatabase": true,
        "deployPrivateEndpointContainerRegistry": true,
        "deployPrivateEndpointContainerAppsEnvironment": true,
        "deployPrivateEndpointSqlServer": true,
        "sqlAdministratorLogin": "sqladmin",
        "sqlAdministratorLoginPassword": "P@ssw0rd123!Prod",
        "existingVnetResourceGroup": "rg-network-prod",
        "containerImage": "mcr.microsoft.com/azuredocs/containerapps-helloworld:latest"
      }
    },
    "variables": "[variables('$fxv#0')]",
    "commonTags": "[variables('$fxv#1')]",
    "parametersAll": "[variables('$fxv#2')]",
    "envParams": "[variables('parametersAll')[parameters('environment')]]",
    "tags": "[union(variables('commonTags'), createObject('Environment', parameters('environment')))]"
  },
  "resources": {},
  "outputs": {
    "location": {
      "type": "string",
      "value": "[variables('variables').location]"
    },
    "tags": {
      "type": "object",
      "value": "[variables('tags')]"
    },
    "namePatterns": {
      "type": "object",
      "value": "[variables('variables').namePatterns]"
    },
    "vnetName": {
      "type": "string",
      "value": "[variables('variables').vnetName]"
    },
    "subnetName": {
      "type": "string",
      "value": "[variables('variables').subnetName]"
    },
    "deployResourceGroup": {
      "type": "bool",
      "value": "[variables('envParams').deployResourceGroup]"
    },
    "deployManagedIdentity": {
      "type": "bool",
      "value": "[variables('envParams').deployManagedIdentity]"
    },
    "deployLogAnalyticsWorkspace": {
      "type": "bool",
      "value": "[variables('envParams').deployLogAnalyticsWorkspace]"
    },
    "deployContainerRegistry": {
      "type": "bool",
      "value": "[variables('envParams').deployContainerRegistry]"
    },
    "deployContainerAppsEnvironment": {
      "type": "bool",
      "value": "[variables('envParams').deployContainerAppsEnvironment]"
    },
    "deployContainerAppJobBill": {
      "type": "bool",
      "value": "[variables('envParams').deployContainerAppJobBill]"
    },
    "deployContainerAppJobData": {
      "type": "bool",
      "value": "[variables('envParams').deployContainerAppJobData]"
    },
    "deploySqlServer": {
      "type": "bool",
      "value": "[variables('envParams').deploySqlServer]"
    },
    "deploySqlDatabase": {
      "type": "bool",
      "value": "[variables('envParams').deploySqlDatabase]"
    },
    "deployPrivateEndpointContainerRegistry": {
      "type": "bool",
      "value": "[variables('envParams').deployPrivateEndpointContainerRegistry]"
    },
    "deployPrivateEndpointContainerAppsEnvironment": {
      "type": "bool",
      "value": "[variables('envParams').deployPrivateEndpointContainerAppsEnvironment]"
    },
    "deployPrivateEndpointSqlServer": {
      "type": "bool",
      "value": "[variables('envParams').deployPrivateEndpointSqlServer]"
    },
    "sqlAdministratorLogin": {
      "type": "string",
      "value": "[variables('envParams').sqlAdministratorLogin]"
    },
    "existingVnetResourceGroup": {
      "type": "string",
      "value": "[variables('envParams').existingVnetResourceGroup]"
    },
    "containerImage": {
      "type": "string",
      "value": "[variables('envParams').containerImage]"
    }
  }
}